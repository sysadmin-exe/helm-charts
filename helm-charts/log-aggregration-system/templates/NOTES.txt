â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘      Log Aggregation System Successfully Deployed! ğŸš€           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Your log aggregation system has been deployed.

DEPLOYED SERVICES:
==================
âœ“ Log Aggregator API (FastAPI)
âœ“ Elasticsearch (Log Storage)
âœ“ OpenTelemetry Collector (Telemetry)

Note: The application exposes metrics, logs, and traces via OpenTelemetry.
External observability tools (Prometheus, Jaeger, Grafana) should be 
configured separately to scrape from this application.

ACCESSING SERVICES:
==================

Get the pod name:
  export POD_NAME=$(kubectl get pods --namespace {{ .Release.Namespace }} -l "app.kubernetes.io/name={{ include "log-aggregation-system.name" . }},app.kubernetes.io/instance={{ .Release.Name }}" -o jsonpath="{.items[0].metadata.name}")

1. Log Aggregator API (Port 8000):
   kubectl --namespace {{ .Release.Namespace }} port-forward $POD_NAME 8000:8000
   
   Then access: http://localhost:8000
   Health Check: http://localhost:8000/health
   API Docs: http://localhost:8000/docs
   Metrics: http://localhost:8000/metrics

2. Elasticsearch (Port 9200):
   kubectl --namespace {{ .Release.Namespace }} port-forward $POD_NAME 9200:9200
   
   Then access: http://localhost:9200

3. OpenTelemetry Collector:
   OTLP gRPC: Port 4317
   OTLP HTTP: Port 4318
   Metrics: Port 8888
   Prometheus Exporter: Port 8889

QUICK START:
===========

1. Check pod status:
   kubectl get pods --namespace {{ .Release.Namespace }} -l "app.kubernetes.io/instance={{ .Release.Name }}"

2. View logs:
   kubectl logs --namespace {{ .Release.Namespace }} $POD_NAME -c log-aggregator
   kubectl logs --namespace {{ .Release.Namespace }} $POD_NAME -c elasticsearch
   kubectl logs --namespace {{ .Release.Namespace }} $POD_NAME -c otel-collector

3. Ingest a test log:
   curl -X POST http://localhost:8000/api/v1/logs/ingest \
     -H "Content-Type: application/json" \
     -d '{
       "logs": [{
         "timestamp": "2025-12-30T10:00:00Z",
         "level": "INFO",
         "message": "Test log entry",
         "source": "test-app"
       }]
     }'

4. Search logs:
   curl http://localhost:8000/api/v1/logs/search?query=test&level=INFO

OBSERVABILITY:
=============
The application exposes:
â€¢ Prometheus metrics at /metrics endpoint (port 8000)
â€¢ OpenTelemetry traces via OTLP (ports 4317, 4318)
â€¢ OTEL Collector metrics (port 8888) and Prometheus exporter (port 8889)

Configure your external observability stack to:
â€¢ Scrape Prometheus metrics from the service
â€¢ Receive OTLP traces from the OTEL Collector
â€¢ Query logs from Elasticsearch

PERSISTENCE:
===========
{{- if .Values.persistence.elasticsearch.enabled }}
âœ“ Elasticsearch data: {{ .Values.persistence.elasticsearch.size }}
{{- else }}
âš  Elasticsearch using ephemeral storage (data will be lost on pod restart)
{{- end }}

TROUBLESHOOTING:
===============
If Elasticsearch takes time to start:
  kubectl describe pod --namespace {{ .Release.Namespace }} $POD_NAME

Check container status:
  kubectl get pod --namespace {{ .Release.Namespace }} $POD_NAME -o jsonpath='{.status.containerStatuses[*].name}'

For more information:
  helm status {{ .Release.Name }} --namespace {{ .Release.Namespace }}
  helm get values {{ .Release.Name }} --namespace {{ .Release.Namespace }}

Documentation: https://github.com/sysadmin-exe/log-aggregation-system
